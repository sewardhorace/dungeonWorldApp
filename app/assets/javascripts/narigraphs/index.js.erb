var pusher = new Pusher('<%= Pusher.key %>');
var channel = pusher.subscribe('test_channel');
console.log("pusher instantiated");

$(document).ready(function() {
  console.log("document ready");
  channel.bind('posted', function(data) {
    console.log("channel bound");
    var $template = $('#narigraph-template > *').clone();
    var $message = $template.find('.message');
    var $characterName = $template.find('strong');
    var $timestamp = $template.find('small');
    var $narigraph = $template.find('.narigraph').removeClass('narigraph');
    $narigraph.addClass(data.new_entry.auto_generated ? 'bold-narigraph' : 'narigraph');
    $message.html(data.new_entry.text);
    $characterName.html('- ' + data.character.name);
    $timestamp.html(moment(data.new_entry.created_at).format("MMM D h:mm"));
    console.log("appended narigraph");
    $('#narigraphs').append($template);
    $('#narigraph_text').val('');
    $('#narigraph_character_name').val('');
  });
})
